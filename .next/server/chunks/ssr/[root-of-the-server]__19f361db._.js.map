{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/moheebmaktabi/Desktop/Arbeit/Codebase/terragreen/src/lib/supabase/unified.ts"],"sourcesContent":["import { createSPAClient } from \"./client\";\nimport { Database } from \"@/lib/types\";\n\nexport enum ClientType {\n    SERVER = 'server',\n    SPA = 'spa'\n}\nexport type TypedSPAClient = ReturnType<typeof createSPAClient>;\n\nexport class SassClient {\n    private client: TypedSPAClient;\n    private clientType: ClientType;\n\n    constructor(client: TypedSPAClient, clientType: ClientType) {\n        this.client = client;\n        this.clientType = clientType;\n    }\n\n    async loginEmail(email: string, password: string) {\n        return this.client.auth.signInWithPassword({ email, password });\n    }\n    async registerEmail(\n        email: string,\n        password: string,\n        metadata?: { first_name?: string; last_name?: string; newsletter?: boolean }\n    ) {\n        const result = await this.client.auth.signUp({\n            email,\n            password,\n            options: {\n                data: metadata || {},\n                emailRedirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}${'/api/auth/callback'}` ,\n            },\n        });\n        return result;\n    }\n\n  \n    async updateUser(data: Record<string, unknown>) {\n        return this.client.auth.updateUser(data);\n    }\n\n    async exchangeCodeForSession(code: string) {\n        return this.client.auth.exchangeCodeForSession(code);\n    }\n\n    async resendVerificationEmail(email: string) {\n        return this.client.auth.resend({ email, type: 'signup' });\n    }\n\n    async logout() {\n        const { error } = await this.client.auth.signOut({ scope: 'local' });\n        if (error) throw error;\n        \n        if (this.clientType === ClientType.SPA) {\n            window.location.href = '/auth/login';\n        }\n    }\n\n    getSupabaseClient() {\n        return this.client;\n    }\n}\n"],"names":[],"mappings":";;;;;;AAGO,IAAA,AAAK,oCAAA;;;WAAA;;AAML,MAAM;IACD,OAAuB;IACvB,WAAuB;IAE/B,YAAY,MAAsB,EAAE,UAAsB,CAAE;QACxD,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,UAAU,GAAG;IACtB;IAEA,MAAM,WAAW,KAAa,EAAE,QAAgB,EAAE;QAC9C,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC;YAAE;YAAO;QAAS;IACjE;IACA,MAAM,cACF,KAAa,EACb,QAAgB,EAChB,QAA4E,EAC9E;QACE,MAAM,SAAS,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACzC;YACA;YACA,SAAS;gBACL,MAAM,YAAY,CAAC;gBACnB,iBAAiB,GAAG,QAAQ,GAAG,CAAC,oBAAoB,GAAG,sBAAsB;YACjF;QACJ;QACA,OAAO;IACX;IAGA,MAAM,WAAW,IAA6B,EAAE;QAC5C,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;IACvC;IAEA,MAAM,uBAAuB,IAAY,EAAE;QACvC,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAsB,CAAC;IACnD;IAEA,MAAM,wBAAwB,KAAa,EAAE;QACzC,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YAAE;YAAO,MAAM;QAAS;IAC3D;IAEA,MAAM,SAAS;QACX,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YAAE,OAAO;QAAQ;QAClE,IAAI,OAAO,MAAM;QAEjB,IAAI,IAAI,CAAC,UAAU,YAAqB;YACpC,OAAO,QAAQ,CAAC,IAAI,GAAG;QAC3B;IACJ;IAEA,oBAAoB;QAChB,OAAO,IAAI,CAAC,MAAM;IACtB;AACJ","debugId":null}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///Users/moheebmaktabi/Desktop/Arbeit/Codebase/terragreen/src/lib/supabase/client.ts"],"sourcesContent":["import {createBrowserClient} from '@supabase/ssr'\nimport {Database} from \"@/lib/types\";\nimport { ClientType, SassClient } from './unified';\n\nexport function createSPAClient() {\n    return createBrowserClient<Database>(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n    )\n}\n\nexport async function createSPASassClient() {\n    const client = createSPAClient();\n    return new SassClient(client, ClientType.SPA);\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,SAAS;IACZ,OAAO,IAAA,iMAAmB;AAI9B;AAEO,eAAe;IAClB,MAAM,SAAS;IACf,OAAO,IAAI,+IAAU,CAAC,QAAQ,+IAAU,CAAC,GAAG;AAChD","debugId":null}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///Users/moheebmaktabi/Desktop/Arbeit/Codebase/terragreen/src/lib/context/GlobalContext.tsx"],"sourcesContent":["// src/lib/context/GlobalContext.tsx\n'use client';\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { createSPASassClient } from '@/lib/supabase/client';\nimport { AddressResult } from '@/components/forms/form_components/AddressAutocomplete';\nimport { NotificationSettingsType, SearchPreferences } from '@/services/UserProfileService';\nimport { Database } from '@/lib/types';\n\n\nexport type CustomUser = {\n    email: string;\n    id: string;\n    registered_at: Date;\n    has_seen_intro?: boolean;\n    user_type?: 'investor' | 'broker';\n    first_name?: string;\n    last_name?: string;\n    phone?: string;\n    stripe_customer_id?: string;\n\n    // Broker specific fields\n    company_name?: string;\n    company_logo_url?: string;\n    company_address?: AddressResult;\n    vat_id?: string;\n    about_me?: string;\n\n    // Investor specific fields\n    notification_settings?: NotificationSettingsType;\n    search_preferences?: SearchPreferences\n};\n\ninterface GlobalContextType {\n    loading: boolean;\n    user: CustomUser | null;\n    updateUser: (updatedUser: Partial<CustomUser>) => void;\n    refreshUser: () => Promise<void>;\n    \n}\n\nconst GlobalContext = createContext<GlobalContextType | undefined>(undefined);\n\nexport function GlobalProvider({ children }: { children: React.ReactNode }) {\n    const [loading, setLoading] = useState(true);\n    const [user, setUser] = useState<CustomUser | null>(null);  // Add this\n\n    const loadUserData = async () => {\n        try {\n            setLoading(true);\n            const supabase = await createSPASassClient();\n            const client = supabase.getSupabaseClient();\n\n            // Get user data\n            const { data: { user } } = await client.auth.getUser();\n            if (user) {\n                // Get user profile data\n                const { data: profile, error: profileError } = await client\n                    .from('users_profile')\n                    .select('*')\n                    .eq('id', user.id)\n                    .single() as {\n                        data: Database['public']['Tables']['users_profile']['Row'] | null;\n                        error: { code?: string; message?: string } | null\n                    };\n\n                if (profileError && profileError.code !== 'PGRST116') {\n                    console.error('Error loading user profile:', profileError);\n                }\n\n                setUser({\n                    // Auth fields\n                    email: user.email!,\n                    id: user.id,\n                    registered_at: new Date(user.created_at),\n                    has_seen_intro: user.user_metadata?.has_seen_intro ?? false,\n                    user_type: user.user_metadata?.user_type ?? null,\n                    first_name: user.user_metadata?.first_name ?? '',\n                    last_name: user.user_metadata?.last_name ?? '',\n\n                    // Profile fields\n                    phone: profile?.phone ?? '',\n                    stripe_customer_id: profile?.stripe_customer_id ?? undefined,\n\n                    // Broker fields\n                    company_name: profile?.company_name ?? '',\n                    company_logo_url: profile?.company_logo_url ?? '',\n                    company_address: profile?.company_address as AddressResult | undefined,\n                    vat_id: profile?.vat_id ?? '',\n                    about_me: profile?.about_me ?? '',\n\n                    // Investor fields\n                    notification_settings: profile?.notification_settings ?\n                        profile.notification_settings as { offers_tips: boolean; news: boolean; status_changes: boolean; } :\n                        {\n                            offers_tips: false,\n                            news: true,\n                            status_changes: true\n                        },\n                    search_preferences: profile?.preferences as SearchPreferences || {}\n                });\n            } else {\n                // User is not logged in - this is a valid state, not an error\n                setUser(null);\n            }\n\n        } catch (error) {\n            console.error('Error loading data:', error);\n            setUser(null);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const updateUser = (updatedUser: Partial<CustomUser>) => {\n        setUser(prev => prev ? { ...prev, ...updatedUser } : null);\n    };\n\n    const refreshUser = async () => {\n        await loadUserData();\n    };\n\n    useEffect(() => {\n        loadUserData();\n    }, []);\n\n    return (\n        <GlobalContext.Provider value={{ loading, user, updateUser, refreshUser }}>\n            {children}\n        </GlobalContext.Provider>\n    );\n}\n\nexport const useGlobal = () => {\n    const context = useContext(GlobalContext);\n    if (context === undefined) {\n        throw new Error('useGlobal must be used within a GlobalProvider');\n    }\n    return context;\n};"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;;;AAGpC;AACA;AAHA;;;;AAwCA,MAAM,8BAAgB,IAAA,sNAAa,EAAgC;AAE5D,SAAS,eAAe,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAoB,OAAQ,WAAW;IAEvE,MAAM,eAAe;QACjB,IAAI;YACA,WAAW;YACX,MAAM,WAAW,MAAM,IAAA,uJAAmB;YAC1C,MAAM,SAAS,SAAS,iBAAiB;YAEzC,gBAAgB;YAChB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,OAAO,IAAI,CAAC,OAAO;YACpD,IAAI,MAAM;gBACN,wBAAwB;gBACxB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,OAChD,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;gBAKX,IAAI,gBAAgB,aAAa,IAAI,KAAK,YAAY;oBAClD,QAAQ,KAAK,CAAC,+BAA+B;gBACjD;gBAEA,QAAQ;oBACJ,cAAc;oBACd,OAAO,KAAK,KAAK;oBACjB,IAAI,KAAK,EAAE;oBACX,eAAe,IAAI,KAAK,KAAK,UAAU;oBACvC,gBAAgB,KAAK,aAAa,EAAE,kBAAkB;oBACtD,WAAW,KAAK,aAAa,EAAE,aAAa;oBAC5C,YAAY,KAAK,aAAa,EAAE,cAAc;oBAC9C,WAAW,KAAK,aAAa,EAAE,aAAa;oBAE5C,iBAAiB;oBACjB,OAAO,SAAS,SAAS;oBACzB,oBAAoB,SAAS,sBAAsB;oBAEnD,gBAAgB;oBAChB,cAAc,SAAS,gBAAgB;oBACvC,kBAAkB,SAAS,oBAAoB;oBAC/C,iBAAiB,SAAS;oBAC1B,QAAQ,SAAS,UAAU;oBAC3B,UAAU,SAAS,YAAY;oBAE/B,kBAAkB;oBAClB,uBAAuB,SAAS,wBAC5B,QAAQ,qBAAqB,GAC7B;wBACI,aAAa;wBACb,MAAM;wBACN,gBAAgB;oBACpB;oBACJ,oBAAoB,SAAS,eAAoC,CAAC;gBACtE;YACJ,OAAO;gBACH,8DAA8D;gBAC9D,QAAQ;YACZ;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uBAAuB;YACrC,QAAQ;QACZ,SAAU;YACN,WAAW;QACf;IACJ;IAEA,MAAM,aAAa,CAAC;QAChB,QAAQ,CAAA,OAAQ,OAAO;gBAAE,GAAG,IAAI;gBAAE,GAAG,WAAW;YAAC,IAAI;IACzD;IAEA,MAAM,cAAc;QAChB,MAAM;IACV;IAEA,IAAA,kNAAS,EAAC;QACN;IACJ,GAAG,EAAE;IAEL,qBACI,8OAAC,cAAc,QAAQ;QAAC,OAAO;YAAE;YAAS;YAAM;YAAY;QAAY;kBACnE;;;;;;AAGb;AAEO,MAAM,YAAY;IACrB,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACvB,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX","debugId":null}}]
}